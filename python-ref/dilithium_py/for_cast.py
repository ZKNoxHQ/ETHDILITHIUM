from .keccak_prng.keccak_prng_wrapper import Keccak256PRNG
from .dilithium.default_parameters import Dilithium2 as D

# from the ledger
pk = bytes.fromhex("783A1F88E77C6D92B0893CD6544BA3F6DFC0831100D82DE1CD7DEC8CBC39AB31B2E0A480DC16122C642B434BBC68DDB3502682FBC16A2D9803EA8A5EC771CF166F0BABF247763208E5421770E1F71FB7E787DDA29804AC4AE08C8AAECAAB3809E7B22D110088C1289B832F8E933AA361301FEB5588650C47901B1C9AF987651E48F0CF5F0B623222BE7DD6EE747FF7AA7B4B006F084F178B818D5A5EA452497AE364918F038015C80DAA1F2AB2A87ED34FA235604EC243EDF3DE0870BF1DCEC895D77B50ACF14945948A8A75A705EA42EE8AA4ED8987AF86A63A54008B5458CD68798E16F28CBF7F38A222FF37BDE9DD6200848E51E78664D158AC9F79E538EA57D28A2A58311D788B92346A692037F9B9B5CEF7F3C6EE9F712C4EA1E4B8D5DB47B57319FEDEE2117C4484AA750E00D981DA218721B1D7D29FE2102B7B45240C82F8A9B899D539CA9D59E7187EA4658C292BDD1F29394928577AAD4C70DED061D9EB9C928475BBE2BA811AC3B4D8138A66DFF327FBCFEA682C1F293DDCA28E737CA9152C77A5EA94580D27E71D57D8D70ECFE62D2EA1E27C588E50101FF8BF1FC52EE922209E8C39792E29A4E41F78C83936BD07CCEB771A79EB47C0DCDB4228E79AA440ABDE8E93758F1985E0EAADC656F013E5AFC0622DB961C5DE6A94910D20C10470CBB7F9F6D4257EC1DCE28A738C4E7B5D8D6F8FEE072DB2D279C40D4DE875BF827AA57EA975813150D282494AEF0C2BCF21D10EC237A21D4F680C087BA68D305CB74A26F73BA572B5713ECA44B1EF0A7125991889E3E7399D52D46CF04D84E44D5C1B74B4D49CF844CFB8D6D9E0394B3EC29E74F7BADF2681EAA05AE11C288F04E9E2CEA9CB78CDD77087CD6C654AE9974A83033D39DFA9F0D1D2A303C68B5B3EAABCDE1150500CAE200D737643C6FD735D771AE003F6E8689D13E2152714F6B0BE856E19A9F50D7D3C4894DB7850F28FDFD099360A4AB83085B9F74FB85A0498AD0A48AF8290572707A0807813AC961611D97B95929A28264D2D8DA29F2A15B52EA1584060B895A25D2E26438177DC5C98BA772F73DD62FB838D83CF7A2101AEC79BEF54850C92BEB0076A7FAE186F7DF057FF92384EEC1D5ED61FDCB613A56F3E47BB4C9112B49E4108696A1AED034168E38D2206594D0D0DE993D1B2BFD2318C4B27145F87C13B4F12E964FFF4E4892C469D9419752E124D93C1579A66C5815641B0EDB8F777BAE49B76BF40FDF13804C77C7A093D45CFAA97FC1014741CB0FDE0B77F3106C0862A1F23CC199A562FE692873AE03B8589750AE5F4E067F52DF8902D881EE63DBCF086724DD5AEB4819C76CDA15F3E93ADDBB287418CC75150D67C57D41C54FC47170642920C570DD4419C02814CF33536A3CD49F13465099AC6637A780E12EC2635A13A4B25007661CCB6A6E0F22267163E37593279D53EFE4D8A7D423FC267C7B1446C8F875E01C54DC20B96C2A496B01E2AED5E39DD7271FC801199F021ED4C4A675B2925E5F048D67FC3F38650F8685BF11DF9AA70F29340BC87469068354E22429B2989DD1CF00CB1078182BD29259366204CB00A9C2C820A0F1C19DB6E405F758A859C0C1DC85E6C265B8026E7A8CB726F77A60A9BE2805DEFB7EF56BA30CE5C70F4DC0F10AF19CA5F79070A2F2DB9363FF5FD883A71E2E61537ADA8B90B729C020F4FBCB5E22D699F10B35D26067F1B81953B41A42115A4622F2A1E5174D8F6658D3F63312144F7C28800A55D0EE8A96A4CAA90E23C66AC8DA0AC43F1AEA45F2ADEA9DB60387F772C1106C6FCD10EEE8BEB542BEEA302B2C70BE38CF4B9C2DAD81C6177BB833373991BC76B4B6BEA08DF7A")

ρ, t1 = D._unpack_pk(pk)
t1_compact = t1.compact_256(32)

A_hat = D._expand_matrix_from_seed(ρ, _xof=Keccak256PRNG)
A_hat_compact = A_hat.compact_256(32)
print("A_HAT=\"{}\"".format(A_hat_compact))

tr = D._h(pk, 64, _xof=Keccak256PRNG)
print("TR=\"0x{}\"".format(tr.hex()))
print("T1=\"{}\"".format([elt[0] for elt in t1_compact]))

# from the ledger (without the message at the end!)
sig = bytes.fromhex("6ccd7c0b048c085f28799ca0e55dc83c1b0eae3b65b770ccaa7e25840e6cb09b4d32fd37b7b2ea44098a6dfe820f4df2b17211671c132b58ee542d2012d2116dbbe71c8fb44ca923e8d43ccc3492782e0bebd7b986e22826b6df0e1540d8a4e5d67d645b5787a1f991788749d996121bbc5058dfcb452495d4240330f1b1d8c69549cb179adf0ad813845afd3f08658e685f8cd9558a3d9b12907111a7c567a274699b7eb78b644e19c0b3d59fd063691efc7eb1f10de9d3b9a435d8e26dece2f8573560bc6bb3bf60257a0bedf7a14e2f0faa18b40c0dfb1c80261abe309f03c0d4e6d8e38b59e63f386e9c7365fba4ee308be1c817ca1c5616c2f8498aa775c32a61b4fc8708275e17cb3e90a8dbabcd8a3d6fa2915dba659f8396a4ce182a30ee7df70aee7fc42ca2203d51288ed7551840df986fad663d4a01f0a757cce2dfcc8637414022bd14445ca4ef1dce04e5e81622ec3e97c5f33b03c616a358a9e5f98e1d42a462873ce8f7728aeb43bfcda35ac5055a0e4d4009e12a36d2a86b3f02e262aea9c98fbb653d28890a0fcf43bf8f952b495997ace97c5dbcd9eab94df95d2b47794d34d04dd3196cdf450d982f5dd61e390b84a5335745bf4549ef064146f89e4042e5364d24d204b8dee9692a012084a28d067269fedd026cf6cfbbe8ed7b3f730442ce47b83af7d95f14b511aaad6b9b9407d655c54e5f07150e2b07e4466a7e2893b305e29b7e341570484a9f8c5bede04b87ede515d44d8b7edbe77ad7e156784096342f3e8c8bc5d9adc0460d36cddc06caf42a5238cc681c4ec44504ea80a566cb27ece1a7683e33ecc7751680e8bb0785fcebbac17f0bbbeb1d0386b0aa319e0470b535b351f38ca35ab8c64e6da65f0f289be6bbd475cded7a3d526e791f0298cb793bcbff0612ccf95aa6ff4feb8b25cb735df652753012cbb4f6ee8f6a88410925b48095d23459c62b47e4e26def441d51346abf07da759dc553e3ddfd8bb9312bb54dcbd0b2a00696c76349f09fbe85f0b977e20376ddb926bff244adb94aabc30f306bf6974b1d9f4f6f7f4a3a83ae4428db820b3cc33edd35587ba4bc0b4fc19e042e18c61e26429e5f9cd3d58169560ea2a1b4b311c69b0cc036f1975aea57bdd221c48de95f5a14c4b7ef2ec5f59715a131ce6ba36a8154d589256954338a993ff2656de31ae9bfc9da11fdf055f7fcb1bfb1a9d5849bee2b39b7cac24a028957383072deb9261e6c0f893eb3c6759a0c0d57c337bb0447ed4a30c781aefff955a81b214e7b3f3603bf06bb1c9b9cc15f0a04dc5f3532cf31d25a2ee5759fd97721a1cd92ea952d04754411ab569186edc02fd221150d377f3aadacc792f3032547ba5e9fb680dbea2b3b9e1012e070e2ef5c8002264dad485828b265abb4877630af903e8c1341b3379e7b9fc3fe689d5ead7abac4cba987be84ba03f21c83b3450c9aa4cb3adcb59e74932d1a7c40fa875189d5b74f932c93a96b8bfa849aee88921da92777823999dc74a9824365b5d4cea2aa3cccd4c20188c51659fa7d7b777d0b6572371d859086fe876d57005a9621906a2874f25d5af7b66c7396e97690b75e1afc562d9c615619a343614b823f7bde7c6d9a835f3272271bc2c5fdcc99357e8ded14df1bae31f79cbfb96fa669aaa0ba682130dd3f0c2a7c6f1be5091df65ccea1ceb8dde6e90abca881f7192fad367ddbc33c09a8b4c637477344713df44a6b8660e6cf99e655fab237135d8e94d9916e24930fbebfbdd017cebe7a4c3a757824e3e475359dafc01754b061b32c45734d23c37d1d8834ee23ee61983f7195ff282ae804922b70f0f9ec50b5b4ab6a515f33b1fa0b99d3d9713e20d1eec70e3ce437aed298d1a96f65c6ac2249bf5a8cb0e65918e786b4a17f38a99d62b9f9ba6650dbed4851c4609c31c159fe5c7e727e2f2991dc323494b7e6b3c7c48b42b333df67e56b9c7a3fd3b3ffbb29cdd074a75ecb6a9837fdf3a52211eedfd74b78873ab36efb02bd2bc9e5c598fc8c577c5f2beb5deb71552480d988f845302450e440f9dce38cb40dcc40f3fe300768da13fec786730bc103e727088e39b6692d37f884d899e1b61aa799bafb22b1b7d7bf6256272e04b15014aca0988d98aa196760eeb327bb70255bfd62e732be895862399062efcc811642de1d062a619beb2f6da3aee3bb42d629509321f71bc0a23d04b568e2e2622d9deee90c05b0fd544f9ac9bf416e04028942cd2fc73ea85ee12e2a1ef1b89a9935e956c105a29f2b65a56e44236883d4e54f6e682a8270ccb966eb2111d938159e5871cfb3bf32985b2bda755e196edda0bef725c9ce3fc6ba42d49798f8a8ece8a9de7c9ee02ec63cb24b08fddda2bf68ace40c26d97bf26c611df80d9914f11b6ab3af7b50da84f59eb5e438761bcccf2091d3fd1de73b383f25fc2770c198607fba34e78cfb38c2aa4a705664fbd3b2f01dbefed05ecfa6d5de43bedda6095bdeedf24081b6c7d3297bec2f5443c7c6912ca1ccf919c1843dcc7861b61455edbfcf50b3c56536b0dddd04505cc96b300fb0c09fe14b74d44622a37379e773bd173cd44aa350144d5f17f1e2aa373014c1979728435c7073f30759aaa5fce37341bee8af71f05620ef3400f69df76d762914c5cd8dcbcc7a2b5fce3a8f0f35cb0c8b01e995999b64b476b78cdf229d06267204a2f16f74ab1d1f66c3bcedef706fea362ce22f613780c428ad14a92eaa111e5040a889e8467a8644475a2e74b267848be9a9ef2e7310893655b6cba9ba75b70394c9d92532684fa1875ceecd0ae7bde6a0e268fc5060fa7167abe874f3de31c7cd445ce6b2c9680f5be9ed2d1feee6e7bc7011d8d6ae7600716cd27f707d339e230fcf5d93c6c1a2e87257a03686c81dbebe4c7c05f04f15afc30658889bf49445508e049b28c9b8d8fcdbc64daa341de7a7438be702f71dda54e5ae878f1453f7456a3dc36efbeb4d3ec76d20077b3e0bc3bf33bf0759c6c68677bd5679ebcc9da22b1169d7817b9a44c24d112af259315e467ba3ad3386a584abfdf8df51247a07d2992c0017ef318e5a94062e68f2648fc155d2e334476d6e0a68d49d1f9001898f1e524d2f512c42bda93a3ed38650c15ad535d908ba10a89766aee07263777e804f65ad354ef82e882ff6f803d78ac3c5074d92a7e455b17842f0af0c386c71605407ff9632546625f2a0bb7198a1a672beff000b533456c16a8bb80284feee7176a233dccbda7b01d30ff6129b4051ebaa20f878d40b333f21d18e60043e60d9000b2325323b3d464a62777b7d8098a0c5e7000c2d46555b717277799da2aabdced3e7ecf508475b6876828cc7d919424551596b7178818294a7accef5f900000000000000000000000000000000000012252e3e")
sig = sig[:]
z_bytes = sig[D.c_tilde_bytes: -(D.k + D.omega)]
h_bytes = sig[-(D.k + D.omega):]
c_tilde, z, h = D._unpack_sig(sig)

print("Z=\"0x{}\"".format(z_bytes.hex()))
print("H=\"0x{}\"".format(h_bytes.hex()))
print("C_TILDE=\"0x{}\"".format(c_tilde.hex()))
